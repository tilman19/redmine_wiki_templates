<%-
  return unless @project
  return unless @project.module_enabled?(:wiki_templates)
  return unless User.current.allowed_to?(:show_wiki_templates, @project)
  return unless controller.class.name == 'WikiController'
  return unless @page.new_record?

  local_templates = WikiTemplate.owned_by(@project.id)
  public_templates = WikiTemplate.others_public(@project.id)
%>
<div id="wiki_templates_select" class="box tabular"><p>
<label for="issue_plantilla"><%= l(:label_choose_template) %></label>
<select id="issue_plantilla" name="issue_plantilla">
  <option value="0" selected="selected"><%= l(:label_wiki_blanco) %></option>
<%- local_templates.each do |template| %>
  <option value="<%= template.id %>"><%= template.name %></option>
<%- end %>
<%- unless public_templates.empty? %>
  <optgroup label='--<%= l(:label_global_sep_template) %>--' ></optgroup>
  <%- public_templates.each do |template| %>
  <option value="<%= template.id %>"><%= template.name %></option>
  <%- end %>
<%- end %>
</select>
<%= submit_tag 'Load', :id => 'load_wiki_template' %>
<!--<button id="load_wiki_template">Load</button>-->
</p></div>

<!--

ボタンを押したらAjaxでテンプレートをロードする
プレビュー機能を参考に。
issue_templateを参考に作ろう。
もしテキストが書き換えられていたら、警告を出す

-->

<script type='text/javascript'>
  var wiki_templates_select = $('#wiki_templates_select');
  $('#wiki_form').before(wiki_templates_select);

  $('#load_wiki_template').click(function() {
    var issue_plantilla = $('#issue_plantilla').val();
    $.get(
      "<%= url_for(:controller => 'wiki_templates', :action => :load) %>",
      $.param({id:$('#issue_plantilla').val()}),
      function(data, status) {
        $("#content_text").val(data);
      },
      "text"
    );
  });
</script>

